<div id="<%= dom_id(message) %>_messages">

  <% if message.user? %>
  
    <div class="m-8 p-4 flex items-start break-all">
      <svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="24px" viewBox="0 0 24 24" width="24px" fill="#000000" class="mr-2">
        <g>
          <rect fill="none" height="24" width="24"/>
        </g>
        <g>
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 4c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6zm0 14c-2.03 0-4.43-.82-6.14-2.88C7.55 15.8 9.68 15 12 15s4.45.8 6.14 2.12C16.43 19.18 14.03 20 12 20z"/>
        </g>
      </svg>
      <div><%= message.content %></div>
    </div>
  <% else %>
    <div class="m-8 p-4 flex items-start break-all">
      <svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="48px" viewBox="0 0 24 24" width="48px" fill="#000000" class="mr-2">
        <rect fill="none" height="24" width="24" y="0"/>
        <path d="M7,20h4c0,1.1-0.9,2-2,2S7,21.1,7,20z M5,19h8v-2H5V19z M16.5,9.5c0,3.82-2.66,5.86-3.77,6.5H5.27 C4.16,15.36,1.5,13.32,1.5,9.5C1.5,5.36,4.86,2,9,2S16.5,5.36,16.5,9.5z M21.37,7.37L20,8l1.37,0.63L22,10l0.63-1.37L24,8 l-1.37-0.63L22,6L21.37,7.37z M19,6l0.94-2.06L22,3l-2.06-0.94L19,0l-0.94,2.06L16,3l2.06,0.94L19,6z"/>
      </svg>

      <% if message.content.include?('```') %>
        <div class="p-4">
          <% content_parts = message.content.split('```') %>
           <div><%= content_parts.first %></div>
          <div class="bg-gray-900 text-white rounded-md my-4 p-4 relative">
            <pre><code><%= content_parts.second %></code></pre>
            <button class="copy-button absolute right-2 top-2  text-white-700 rounded-md py-1 px-2 border flex" onclick="copyCode(this.parentNode.querySelector('code'))">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h6m4 0h6m-6 0v12m0 0H4m0 0V6m0 0h6m-6 0v12m6 0h6m-2-12l-2 2m0 0-2-2m2 2v10" />
              </svg>
              Copy Code
            </button>
          </div>
          <% if content_parts.size > 2 %>
            <div class="px-4 rounded-b-md">
             <%= content_parts[2..-1].join('') %>
             </div>
          <% end %>
        </div>
        <style>
          .copy-button {
            transition-duration: 0.4s;
          }
          .copy-button:hover {
            background-color: 	#36454F;
          }
        
          .bg-gray-100 {
            background-color: #f1f1f1;
          }
          .bg-gray-900 {
            background-color: #111;
          }
        </style>
        <script>
          function copyCode(codeElement) {
            var code = codeElement.innerText;
            navigator.clipboard.writeText(code).then(function() {
              console.log('Code copied to clipboard.');
              var button = document.querySelector('.copy-button');
              button.innerText = 'Copied!';
              setTimeout(function() {
                button.innerText = 'Copy Code';
              }, 2000);
            }).catch(function() {
              console.error('Failed to copy code to clipboard.');
            });
          }
        </script>
      <% else %>
        <div>
          <div><%= message.content %></div>
        </div>
      <% end %>
    </div>
  <% end %>
</div>
 